# Redis 기반 개발 보고서 및 회고록

## 개요

- DB에 많은 부하가 예상되는 기능들을 Redis로 변경하여 성능 개선
- 인기 상품 조회 기능 DB → Redis 변경
- 쿠폰 발급 및 사용 DB → Redis 변경

## 해결

1. 인기 상품 조회
    - 하루 단위로 Sorted Set 자료구조를 사용하여 상품 랭킹 저장
    - 최종 주문, 결제가 완료되었을 때 주문한 상품에 대한 스코어 증가 처리
    - ZUNIONSTORE 명령어를 사용하여 필요한 날의 랭킹 정보 합산하여 리턴
2. 쿠폰 발급 및 사용
    - Hash 자료구조를 사용하여 발급요청 인원 중복체크 및 관리
    - List 자료구조를 사용하여 쿠폰 재고 관리
    - 쿠폰 발급 요청 시 기존에 발급 받은 인원인지 확인
    - 최초 발급 인원일 경우 쿠폰 재고 List leftPoP 처리하여 쿠폰 발급
    - 발급 된 쿠폰 사용 시 Redis에서 삭제 및 DB 저장

## 회고

1. 인기 상품 조회
    - 랭킹 정보를 합산할 때 어플리케이션 비즈니스 로직에서 처리를 하려 했으나 Redis에서ZUNIONSTORE 명령어를 통해서 간편하게 랭킹 정보를 합산할 수 있어 해당 명령어를 사용하여 랭킹 정보 합산을 실시
    - 지원하는 명령어를 적극적으로 사용하는것 or 비즈니스 로직에서 계산하는 것 각각의 장단점에 대해서 고민이 필요해 보임
2. 쿠폰 발급 및 사용
    - 쿠폰 사용 시에만 DB에 데이터를 저장함으로서 대부분의 기능에 대해 Redis를 적극 사용하였는데, 쿠폰 사용 전까지 발급 데이터가 Redis 메모리에만 존재 한다는게 뭔가 불안한 느낌이 듬.
        
         Batch 사용으로 DB에 저장해주는게 더 좋았을지 고민 필요
        
    - 쿠폰 발급 시 Redis가 제공하는 원자성을 보장해주는 명령어를 사용하여 초과 발급이 안되도록 처리하였으나 Lua 스크립트를 통해 좀 더 확실히 원자성을 보장하는 방법 고려 필요
